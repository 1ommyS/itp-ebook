# –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π —Ö—ç—à - –≤–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è

---

## 1. –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è

**–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–ª—é—á–µ–π (–¥–∞–Ω–Ω—ã—Ö) –ø–æ —É–∑–ª–∞–º (—à–∞—Ä–¥–∞–º, –∫—ç—à—É, —Å–µ—Ä–≤–µ—Ä–∞–º) —Ç–∞–∫, —á—Ç–æ–±—ã –ø—Ä–∏ **–¥–æ–±–∞–≤–ª–µ–Ω–∏–∏** –∏–ª–∏ **—É–¥–∞–ª–µ–Ω–∏–∏** —É–∑–ª–∞ **–º–∏–Ω–∏–º–∞–ª—å–Ω–æ** (‚âà O(1/N) –æ—Ç –≤—Å–µ—Ö –∫–ª—é—á–µ–π) –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–ª–∏—Å—å (—Ä–µ–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏—Å—å) –∏—Ö —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è.

* –í –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–º —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–∏ (`key mod N`) –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —É–∑–ª–∞ —Ç—Ä–µ–±—É–µ—Ç **–ø–µ—Ä–µ—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö** –∫–ª—é—á–µ–π.
* –ü—Ä–∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–º ‚Äî –º–µ–Ω—è—é—Ç—Å—è –ª–∏—à—å –∫–ª—é—á–∏, ¬´—Ä–∞—Å–ø–æ–ª–∞–≥–∞–≤—à–∏–µ—Å—è¬ª –º–µ–∂–¥—É —Å–æ—Å–µ–¥–Ω–∏–º–∏ —É–∑–ª–∞–º–∏ –Ω–∞ –∫–æ–ª—å—Ü–µ.

---

## 2. –ê–ª–≥–æ—Ä–∏—Ç–º ¬´—Ö–µ—à-–∫–æ–ª—å—Ü–∞¬ª

1. **–ö–æ–ª—å—Ü–æ —Ö–µ—à–µ–π.** –ü—Ä–µ–¥—Å—Ç–∞–≤–∏–º –∫—Ä—É–≥ (0‚Ä¶2¬≥¬≤‚àí1), –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è —Ç–æ—á–∫–∏-—É–∑–ª—ã (nodes), –∫–∞–∂–¥–∞—è –∏–º–µ–µ—Ç —Å–≤–æ–π —Ö–µ—à-–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä `H(node)`.

2. **–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —É–∑–ª—ã (vnodes).** –ß—Ç–æ–±—ã —Å–Ω—è—Ç—å –ø—Ä–æ–±–ª–µ–º—É –Ω–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è (—Ä–∞–∑—Ä–µ–∂—ë–Ω–Ω—ã—Ö –∑–æ–Ω), –Ω–∞ –∫–æ–ª—å—Ü–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —É–∑–ª–∞ —Å–æ–∑–¥–∞—é—Ç M –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —Ç–æ—á–µ–∫:

   ```
   H(node + ‚Äú#0‚Äù), H(node + ‚Äú#1‚Äù), ‚Ä¶, H(node + ‚Äú#M‚àí1‚Äù)
   ```

   –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–æ–ª–µ–µ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ö–µ—à-–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞.

3. **–†–∞–∑–º–µ—â–µ–Ω–∏–µ –∫–ª—é—á–µ–π.** –î–ª—è –∫–∞–∂–¥—ã–π –∫–ª—é—á `k` –≤—ã—á–∏—Å–ª—è–µ–º `h = H(k)` –∏ –¥–≤–∏–≥–∞–µ–º—Å—è –ø–æ –∫–æ–ª—å—Ü—É **–ø–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ**, –ø–æ–∫–∞ –Ω–µ –Ω–∞–π–¥—ë–º –ø–µ—Ä–≤—É—é —Ç–æ—á–∫—É (–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π —É–∑–µ–ª) —Å `H(node_v) ‚â• h`. –ö–ª—é—á –ø–æ–ø–∞–¥–∞–µ—Ç –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —ç—Ç–æ–º—É vnode —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π —É–∑–µ–ª.

4. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–∑–ª–∞.** –ù–∞ –∫–æ–ª—å—Ü–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –µ–≥–æ M –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —Ç–æ—á–µ–∫. –ö–ª—é—á–∏, —á–µ–π —Ö–µ—à –ø–æ–ø–∞–¥–∞–µ—Ç –º–µ–∂–¥—É —Å–æ—Å–µ–¥–Ω–∏–º–∏ —Ç–æ—á–∫–∞–º–∏ –Ω–æ–≤–æ–≥–æ —É–∑–ª–∞, —Ç–µ–ø–µ—Ä—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∫ –Ω–µ–º—É. –û—Å—Ç–∞–ª—å–Ω—ã–µ ‚Äî –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ —Ç–µ—Ö –∂–µ —É–∑–ª–∞—Ö.

5. **–£–¥–∞–ª–µ–Ω–∏–µ —É–∑–ª–∞.** –¢–æ—á–∫–∏ –∏—Å—á–µ–∑–∞—é—Ç; –∫–ª—é—á–∏, –∫–æ—Ç–æ—Ä—ã–µ ¬´–ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞–ª–∏¬ª —ç—Ç–∏–º —Ç–æ—á–∫–∞–º, –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É–∑–ª—É –ø–æ –∫–æ–ª—å—Ü—É.

---

## 3. –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏

| –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞                                    | –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏                                             |
| ----------------------------------------------- | ------------------------------------------------------ |
| üîπ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–µ–ª–æ–∫–∞—Ü–∏—è (‚âà1/M —á–∞—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö)    | üî∏ –ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–ª—å—Ü–∞       |
| üîπ –õ—ë–≥–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑            | üî∏ –°–ª–æ–∂–Ω–æ—Å—Ç—å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –±–µ–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —É–∑–ª–æ–≤        |
| üîπ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–∏–Ω–∞–º–∏–∫–∏ (Dynamo, Cassandra, etc.) | üî∏ –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —á–∏—Å–ª–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —É–∑–ª–æ–≤ (M) |
| üîπ –ü—Ä–æ–∑—Ä–∞—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–±–æ—Ä–∫–∞ ¬´–±–∏—Ç—ã—Ö¬ª –Ω–æ–¥     | üî∏ –†–∏—Å–∫ ¬´–≥–æ—Ä—è—á–∏—Ö —Ç–æ—á–µ–∫¬ª –ø—Ä–∏ –ø–ª–æ—Ö–æ–º –≤—ã–±–æ—Ä–µ —Ö–µ—à‚Äê—Ñ—É–Ω–∫—Ü–∏–∏  |

---

## 4. –í–∞—Ä–∏–∞–Ω—Ç—ã –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

### 4.1. –í–∑–≤–µ—à–µ–Ω–Ω—ã–µ —É–∑–ª—ã (Weighting)

–ß—Ç–æ–±—ã —É–∑–ª—ã —Ä–∞–∑–Ω–æ–π –º–æ—â–Ω–æ—Å—Ç–∏ –Ω–µ—Å–ª–∏ **—Ä–∞–∑–Ω—ã–π –æ–±—ä—ë–º** –∫–ª—é—á–µ–π, –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —Ç–æ—á–µ–∫ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –≤–µ—Å—É `w_i`:

```
M_i = M_total * (w_i / ‚àë w_j)
```

–ß–µ–º –≤—ã—à–µ –º–æ—â–Ω–æ—Å—Ç—å, —Ç–µ–º –±–æ–ª—å—à–µ —Ç–æ—á–µ–∫ ‚Äî —Ç–µ–º –±–æ–ª—å—à–µ –∫–ª—é—á–µ–π ¬´–ø—Ä–∏–ø–∞–¥—ë—Ç¬ª –Ω–∞ —É–∑–µ–ª.

### 4.2. –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å

–î–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ –∫–∞–∂–¥—ã–π –∫–ª—é—á –º–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å **–Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö** –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —É–∑–ª–∞—Ö –ø–æ –∫–æ–ª—å—Ü—É (–æ–±—ã—á–Ω–æ R —Å–æ—Å–µ–¥–Ω–∏—Ö vnodes):

* **–ü–µ—Ä–≤–∏—á–Ω—ã–π** —É–∑–µ–ª ‚Äî –ø–µ—Ä–≤—ã–π –ø–æ—Å–ª–µ `h`.
* **–°–ª—ç–π–≤—ã-—Ä–µ–ø–ª–∏–∫–∏** ‚Äî —Å–ª–µ–¥—É—é—â–∏–µ R‚àí1 —É–∑–ª–æ–≤ –ø–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ.

–ü—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –ª—é–±–æ–≥–æ —É–∑–ª–∞ –µ–≥–æ –∫–ª—é—á–∏ –æ–±—Å–ª—É–∂–∏–≤–∞—é—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Ä–µ–ø–ª–∏–∫–∏.

### 4.3. –ì–∏–±—Ä–∏–¥ —Å directory-based

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–∏—Å—Ç–µ–º—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, Amazon DynamoDB) –¥–æ–±–∞–≤–ª—è—é—Ç **–∫–∞—Ç–∞–ª–æ–≥ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö** –æ —Ç–æ–º, –∫–∞–∫–∏–µ —É–∑–ª—ã —Å–µ–π—á–∞—Å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã, –∞ –∫–∞–∫–∏–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è ‚Äî —á—Ç–æ–±—ã –∫–ª–∏–µ–Ω—Ç—ã –º–æ–≥–ª–∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–ª—å—Ü–æ –Ω–∞ –ª–µ—Ç—É.

---

## 5. –•–µ—à-—Ñ—É–Ω–∫—Ü–∏–∏

–í—ã–±–æ—Ä —Ö–µ—à-—Ñ—É–Ω–∫—Ü–∏–∏ –∫—Ä–∏—Ç–∏—á–µ–Ω –¥–ª—è —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è. –ù–∞–∏–±–æ–ª–µ–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã:

* **MurmurHash**, **FarmHash** ‚Äî –±—ã—Å—Ç—Ä—ã–µ, —Ö–æ—Ä–æ—à–µ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ.
* **MD5**, **SHA-1** ‚Äî –∫—Ä–∏–ø—Ç–æ-—Å—Ç–æ–π–∫–∏–µ, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ.
* **CityHash**, **xxHash** ‚Äî –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö CPU.

–í–∞–∂–Ω–æ, —á—Ç–æ–±—ã —Ñ—É–Ω–∫—Ü–∏—è:

1. –î–µ–ª—è–ª–∞ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ.
2. –ë—ã–ª–∞ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∞ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–∞ –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏ (—á—Ç–æ–±—ã –∫–æ–ª—å—Ü–æ –Ω–µ ¬´–ø–ª–∞–≤–∞–ª–æ¬ª).

---

## 6. –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 6.1. Memcached (Ketama)

* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–ª—å—Ü–µ–≤–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ —É–∑–ª–∞–º–∏ (¬´Ketama¬ª protocol).
* –ö–ª–∏–µ–Ω—Ç —Å—Ç—Ä–æ–∏—Ç –∫–æ–ª—å—Ü–æ —É–∑–ª–æ–≤, —É–∑–ª—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è/–¥–æ–±–∞–≤–ª—è—é—Ç—Å—è.
* –ë–ª–∞–≥–æ–¥–∞—Ä—è —ç—Ç–æ–º—É **–ø—Ä–∏ —Å—Ç—Ä–æ–≥–æ–º —Ä–∞–∑–≥–æ–Ω–µ –∫–ª—é—á–µ–π** –ø—Ä–∏ —Å–º–µ–Ω–µ –∫–ª–∞—Å—Ç–µ—Ä–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–æ—Ç–µ—Ä—è –ø–æ–ø–∞–¥–∞–Ω–∏–π –≤ –∫—ç—à.

### 6.2. Amazon Dynamo / Cassandra

* –ö–∞–∂–¥–∞—è –Ω–æ–¥–∞ –∏–º–µ–µ—Ç —Ç–æ–∫–µ–Ω(—ã) –Ω–∞ –∫–æ–ª—å—Ü–µ (–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏).
* –î–∞–Ω–Ω—ã–µ —Ä–µ–ø–ª–∏—Ü–∏—Ä—É—é—Ç—Å—è –Ω–∞ R –±–ª–∏–∂–∞–π—à–∏—Ö —É–∑–ª–æ–≤.
* –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç **gossip-–ø—Ä–æ—Ç–æ–∫–æ–ª** –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–º–µ–Ω–µ —Ç–æ–ø–æ–ª–æ–≥–∏–∏.

### 6.3. Consistent Hashing –≤ HTTP-load-balancers

* HAProxy, Nginx (with `hash $request_uri consistent;`)
* –ü–æ–∑–≤–æ–ª—è–µ—Ç ¬´–ø—Ä–∏–ª–∏–ø–∞—Ç—å¬ª –∫–ª–∏–µ–Ω—Ç–æ–≤ –∫ –æ–¥–Ω–∏–º –∏ —Ç–µ–º –∂–µ –±—ç–∫–µ–Ω–¥–∞–º –¥–ª—è —Å–µ—Å—Å–∏–π.
